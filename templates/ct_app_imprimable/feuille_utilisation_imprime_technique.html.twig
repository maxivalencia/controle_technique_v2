<html>
    <head>
        <meta charset="UTF-8">
        <title>Feuille d'utilisation des imprimés techniques</title>
        <style>
            html{margin:20px 20px 20px 20px;}
            #footer{
                position:fixed;
                bottom:0px;
                left:0px;
                right:0px;
                height:10px;
            }
            #footer .page-number:after { content: counter(page); }
        </style>
    </head>
    <body style="font-size:12px">
        <table style="font-size:12px">
            <tr>
                <td width="300" align="center">
                    <strong>DIRECTION GENERALE DE LA SECURITE ROUTIERE</strong>
                    <br>-----------------------------<br>
                    <strong>DIRECTION DES OPERATIONS ROUTIERE</strong>
                    <br>-----------------------------<br>
                    <strong>
                        CENTRE DE SECURITE ROUTIERE<br>
                        {{ province }} - {{ centre }}
                    </strong>
                    <br>-----------------------------<br>
                    {# <img src="{{ logo }}" alt="logo" width="50px" height="50px" type="images/png"> #}
                    <img src="{{ logo }}" alt="logo" width="50px" height="50px" type="images/png">
                    <br>« LAHITOKANA NY AINA » 
                </td>
                <td width="250">
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                </td>
                <td width="200" align="center" valign="top">
                    {% set trans_day_hash = { 
                            "January": "Janvier", 
                            "February": "Février", 
                            "March": "Mars", 
                            "April": "Avril", 
                            "May": "Mai", 
                            "June": "Juin", 
                            "July": "Juillet",
                            "August": "Août",
                            "September": "Septembre",
                            "October": "Octobre",
                            "November": "Novembre",
                            "December": "Décembre" 
                        } 
                    %}
                    REPOBLIKAN’I MADAGASIKARA<br>
                    <i>Fitiavana-Tanindrazana-Fandrosoana</i>
                    <br><br>--------------------------<br><br>
                    {{ province }}, le {{ "now"|date('d') }} {{ trans_day_hash["now"|date('F')] }} {{ "now"|date('Y') }}
                    <br><br>--------------------------<br><br>
                </td>
            </tr>
        </table>
        <div align="center" style="font-size:14px;"><u><H3>FEUILLE D'UTILISATION DES IMPRIMES TECHNIQUES</H3></u></div>
        <div style="margin-left:10px;">
            <table>
                <tr>
                    <td width="300" align="left"><span style="font-size:14px;"><u>Centre</u> : <strong>{{ centre }}</strong></span></td>
                </tr>
                <tr>
                    <td align="left"><span style="font-size:14px;"><u>Date</u> : <strong>{{ date_visite|date('d') }} {{ trans_day_hash[date_visite|date('F')] }} {{ date_visite|date('Y') }}</strong></td>
                </tr>
            </table>
        </div>
        <table align="center" style="border: 2px solid black;border-collapse: collapse;font-size:8px">
            <tr align="center">
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>N°</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>REFERENCE OPERATION</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>N° IMM</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>Motif</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>PVO<br>(1)</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>PVM<br>(2)</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>PVMC<br>(3)</strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>PVMR<br>(4)</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>CE<br>(5)</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>CB<br>(6)</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>CJ<br>(7)</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>CJBR<br>(8)</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>CR<br>(9)</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>CAE<br>(10)</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>CIM31<br>(11)</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>CIM31B<br>(12)</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>CIM32<br>(13)</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>CIM32B<br>(14)</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>PLQ<br>(15)</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>ADM<br>(16)</i></strong></td>
                <td align="center" valign="middle" width="45" style="border: 1px solid black;border-collapse: collapse;"><strong><i>OBSERVATION</i></strong></td>
            </tr>
            {% for ct_imprime_tech_use in ct_imprime_tech_uses %}
                <tr style="font-size:8px;">
                    <td align="center" style="border: 1px solid black;border-collapse: collapse;">{{ ct_imprime_tech_use.controle_pv }}</td>
                    <td align="center" style="border: 1px solid black;border-collapse: collapse;">{{ ct_imprime_tech_use.immatriculation }}</td>
                    <td align="center" style="border: 1px solid black;border-collapse: collapse;">{{ ct_imprime_tech_use.usage }}</td>
                    <td align="center" style="border: 1px solid black;border-collapse: collapse;">{{ ct_imprime_tech_use.aptitude }}</td>
                    <td align="center" style="border: 1px solid black;border-collapse: collapse;">{{ ct_imprime_tech_use.verificateur }}</td>
                    <td align="center" style="border: 1px solid black;border-collapse: collapse;">{{ ct_imprime_tech_use.cooperative }}</td>
                    <td align="right" style="border: 1px solid black;border-collapse: collapse;">{{ ct_imprime_tech_use.droit|number_format(0, ',', ' ') }}</td>
                    <td align="right" style="border: 1px solid black;border-collapse: collapse;">{{ ct_imprime_tech_use.prix_pv|number_format(0, ',', ' ') }}</td>
                    <td align="right" style="border: 1px solid black;border-collapse: collapse;">{{ ct_imprime_tech_use.carnet|number_format(0, ',', ' ') }}</td>
                    <td align="right" style="border: 1px solid black;border-collapse: collapse;">{{ ct_imprime_tech_use.carte|number_format(0, ',', ' ') }}</td>
                    <td align="right" style="border: 1px solid black;border-collapse: collapse;">{{ ct_imprime_tech_use.tva|number_format(0, ',', ' ') }}</td>
                    <td align="right" style="border: 1px solid black;border-collapse: collapse;">{{ ct_imprime_tech_use.timbre|number_format(0, ',', ' ') }}</td>
                    <td align="right" style="border: 1px solid black;border-collapse: collapse;">{{ ct_imprime_tech_use.montant|number_format(0, ',', ' ') }}</td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="15">Aucun enregistrement trouvé</td>
                </tr>
            {% endfor %}
        </table>
        <br>
        <div style="font-size:14px;margin-left:600px;">
            <div align="center"><u><strong>RECAPITULATION</strong></u></div>
            <div>
                <strong>
                    Nombre : {{ nombre_visite|number_format(0, ',', ' ') }}<br>
                    Total des Droits : Ar {{ total_des_droits|number_format(0, ',', ' ') }}<br>
                    Total des Prix PV : Ar {{ total_des_prix_pv|number_format(0, ',', ' ') }}<br>
                    Total des Prix Carnets : Ar {{ total_des_carnets|number_format(0, ',', ' ') }}<br>
                    Total des Prix Cartes : Ar {{ total_des_cartes|number_format(0, ',', ' ') }}<br>
                    Total TVA : Ar {{ total_des_tva|number_format(0, ',', ' ') }}<br>
                    MONTANT TOTAL : Ar {{ montant_total|number_format(0, ',', ' ') }}<br>
                </strong>
            </div>
        </div>
        <br>
        <div align="center" style="font-size:14px;margin-left:50px;">
            <div align="center"><u><strong>RECAPITULATION PAR USAGE EFFECTIF</strong></u></div>
            <div style="font-size:12px;">
                {% set colonne = 5 %}
                {% set colonne_encours = 0 %}
                <table>
                {% for usage in liste_usage %}
                    {% if colonne_encours == 0 %}
                        <tr>
                    {% endif %}
                    {# <td align="right" style="border: 0px solid black;" width="125"> {{ usage.usage }} : </td>
                    <td align="left" style="border: 0px solid black;" width="10"><strong> {{ usage.nombre }} </strong></td> #}
                    <td align="right" style="border: 0px solid black;" width="125"> {{ usage.usage }} : </td>
                    <td align="left" style="border: 0px solid black;" width="10"><strong> {{ usage.nombre }} </strong></td>
                    {% set colonne_encours = colonne_encours + 1 %}
                    {% if colonne_encours == colonne %}
                        </tr>
                        {% set colonne_encours = 0 %}
                    {% endif %}
                {% endfor %}
                </table>
            </div>
        </div>
        <div style="font-size:14px;margin-left:600px;" align="center">
            <br><br>
            {{ province }}, le {{ "now"|date('d') }} {{ trans_day_hash["now"|date('F')] }} {{ "now"|date('Y') }}<br>
            <strong>Le chef de Centre<strong>
        </div>
        <div id="footer">
            {# <span><p class="page-number">Page </p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> #}
            <script type="text/php">
                if ( isset($pdf) ) {
                    // OLD 
                    // $font = Font_Metrics::get_font("helvetica", "bold");
                    // $pdf->page_text(72, 18, "{PAGE_NUM} of {PAGE_COUNT}", $font, 6, array(255,0,0));
                    // v.0.7.0 and greater
                    $x = 750;
                    $y = 575;
                    $text = "page : {PAGE_NUM} sur {PAGE_COUNT}";
                    $font = $fontMetrics->get_font("helvetica", "bold");
                    $size = 8;
                    $color = array(0, 0, 0);
                    $word_space = 0.0;  //  default
                    $char_space = 0.0;  //  default
                    $angle = 0.0;   //  default
                    $pdf->page_text($x, $y, $text, $font, $size, $color, $word_space, $char_space, $angle);
                    
                    $x2 = 40;
                    $y2 = 575;
                    $text2 = "Editée le {{ "now"|date('d') }} {{ trans_day_hash["now"|date('F')] }} {{ "now"|date('Y') }} à {{ "now"|date('H') }}:{{ "now"|date('m') }}:{{ "now"|date('s') }} par {{ user.usrNom }}"; 
                    $pdf->page_text($x2, $y2, $text2, $font, $size, $color, $word_space, $char_space, $angle);
                }
            </script>
        </div>
    </body>
</html>